# 任务 E：互联网仿真

> 互联网（Internet），指当今全球最大的计算机信息网络，这些网络以一组通用的协议相连，形成逻辑上的单一且巨大的全球化网络，在这个网络中有交换机、路由器等网络设备、各种不同的连接链路、种类繁多的服务器和数不尽的计算机、终端。使用互联网可以将信息瞬间发送到千里之外的人手中，它是信息社会的基础设施。
> 
> 相信你在使用互联网时，一定对它的工作原理产生好奇心。它到底是怎样实现信息互通的功能的？校园网或是外网的拦截又是如何生效的？“传说中”的各类网络攻击又是如何生效的？又或许你有个黑客梦，想自己构造一个属于自己的互联网，在里面当黑客呢？那就一起来看看吧。

本题将以 Docker 这一工具为基础，旨在帮助大家打通从一个个容器到一张互联网组建的全过程，让大家对计算机网络有深入了解。
***
## PreTask

### PreTask 1

> Docker 是一个开源的应用容器引擎，基于 Go 语言并遵从 Apache2.0 协议开源。它可以让开发者打包他们的应用以及依赖包到一个轻量级、可移植的容器中，然后发布到任何流行的 Linux 机器上，使得程序可以在任何环境都会有一致的表现，也可以实现虚拟化。Docker 也可以实现将服务模块化，是前后端开发的有力工具之一。这个 PreTask 1 旨在帮助你更好快速了解及上手 Docker。

1. 使用 Docker 从当下发布的流行的 Ubuntu 各版本（16.04, 20.04, 22.04, 24.04 均可）拉取镜像并建立一个新容器，并在其中任意位置新建文件，内容任意
2. 完成第一小题后请找到你所建立的这个容器的 Dockerfile，并逐句分析每行语句的意义与作用
3. Dockerfile 还有哪些其他的语句？它们的意义和作用又是什么？
4. 通过以上小题，你认为 Dockerfile 存在的意义和最大的作用在于哪？它如何帮助实现 Docker 的各项功能？

***
### PreTask 2

> Shell 脚本（Shell Script）是一种为 shell 编写的脚本程序。它既是一种命令语言，又是一种程序设计语言。这个 PreTask 2 旨在帮助你更快上手编写 Shell 脚本

1. 利用 Docker 再建立一个新的 Ubuntu 容器，编写一个 Shell 脚本，实现快速排序，保存在容器的 /tmp 目录下
2. 将这个容器打包为镜像，命名为 E_PreTask_1.tar 作为附件提交
***
## Task 1

> 经过前面的两个 Pre-Task，相信你已经对 Docker 和 Shell 脚本有了一定的了解。但 Docker 的强大远不止于此，对于一个多服务的项目，它需要多容器运行多个进程来实现服务开发，那么这样的项目必然需要容器之间的依赖关系，在 Docker 中有一个工具叫 Docker Compose，它能通过自定义的配置，从而达成一个命令行就能启动所有容器及其依赖关系从而启动服务，我们现在就利用它来构建一个简单的“互联网”。

现在你需要做的是利用 Dockerfile 和 Docker Compose 自定义构建一个“互联网”，要求如下：

- 需要 20 个容器（使用 Ubuntu22.04 amd64 镜像）
- 使用 Docker compose 组建而成
- 实现容器之间能相互 ssh 访问
- 请将你构建的“互联网”各容器 Dockerfile 和 Docker Compose 配置文件打包成 E_Task_1.zip 作为附件提交

Hint：

- 要实现容器之间的互连需要什么呢？
- 如果能实现容器之间的互连，那要怎样通过 Docker Compose 和 Dockerfile 使得每个容器带有 ssh 服务呢？
***
## Task 2

> 或许你已经发现了，我们在 Task 1 当中所构建的“互联网”并非如现实一样，只是单纯的 20 个容器以宿主机为载体汇聚在一起，那么这个 Task 2 就带你真正了解互联网的核心—— BGP 路由，帮助你更好完成接下来的任务。

### Task 2.1 

（1）什么是自治系统？自治系统分为几种类别？它们的作用又是什么？

（2）请查询浙江大学（紫金港校区）所在的自治系统编号，它是由哪个机构进行管理的？所包含的 IP 段又有哪些？

（3）利用 mtr 这个工具展示从校园内部出发访问 Github 服务器所经过的自治系统路径

	1. mtr 工具实现的核心是数据包的哪一个字段？据此 mtr 的工作原理是什么？
	2. 其中你可能会发现有一些自治系统编号未显示，还有一些节点甚至许久没有反应，出现这种现象的可能原因有哪些？

（4）自治系统是如何互相交换数据包的？它们之间需要建立什么样的关系？这样的关系又分为哪些？
***
### Task 2.2

（1）BGP 分为哪两种运行方式？

（2）BGP 报文又分为哪几种？分别有什么作用？它们又有哪些组成部分？

（3）BGP 又是如何处理路由的？在选择 AS 路径时又有哪些评判标准？
***
## Task 3

> 经过 Task 2，相信你已经对互联网的原理有了深刻的了解，那么接下来就是你真正构建一个互联网的时刻了。

你需要做的是利用 Dockerfile 和 Docker Compose 构建一个自定义互联网，要求如下：

- 至少 5 个末端/残桩自治系统（Stub AS）和 2 个转送/过境自治系统（Transit AS），每个末端/残桩自治系统含至少 4 个容器节点
- 使用 Docker Compose 组建而成
- 使用 BGP 路由器来处理数据包的流通（AS 路径选择原则任意但是需要说明）
- 实现任意容器可以 ping 通不同自治系统中的容器
- 请将各容器 Dockerfile 以及 Docker Compose 配置文件打包成 E_Task_3.zip 作为附件提交

Hint:

- BGP 路由器可以采用现有开源的应用程序（比如 BIRD，这需要你充分了解 BIRD 是如何实现 BGP 路由的），和 Task 1 类似的，如何让这个应用程序在容器中安装运行呢？
- 你可能需要在容器中完成数据包的嗅探和处理功能，这些又该靠什么完成呢？
***
## Bonus

### Bonus 1

> 经历了 Task 3，你已经成功构建了一个简单的互联网，那么如何实现类似校园网的功能呢？（即从外界自治系统无法访问只能内部互相访问）

你需要做的是在 Task 3 的基础上将某一个自治系统作为“校园”，使得其他自治系统无法 ping 通内部的容器，但内部的容器仍然能够相互 ping 通，要求如下：

- 请将各容器 Dockerfile 以及 Docker Compose 配置文件打包成 E_Bonus_1.zip 作为附件提交
***
### Bonus 2

> 或许你还想在自己构建的这个互联网中实现网络攻击，体验一下当黑客的感觉……

1. 请结合 2008 年 2 月 24 日巴基斯坦禁用 Youtube 这一事件讲述 BGP 前缀劫持攻击的详细原理以及解决方法
2. 在 Task 3 所构建的互联网基础上复现这一事件的攻击过程（包括后续修复），要求如下：

- 请说明你的攻击方和受害者分别是哪两个节点
- 请将各容器 Dockerfile 以及 Docker Compose 配置文件打包成 E_Bonus_2.zip 作为附件提交
